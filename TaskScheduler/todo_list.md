# 并发控制与任务排队机制 - TODO List

## 📋 总体目标
实现任务调度平台的并发控制与任务排队机制，确保系统资源的合理利用。

## ✅ 功能要求

### 1. 任务类型分类机制
- [ ] 为TaskRequest添加taskType字段，支持任务分类
- [ ] 创建TaskType枚举或配置类
- [ ] 更新TaskRequest模型和相关接口

### 2. 并发控制配置
- [ ] 创建ConcurrencyConfig配置类，支持每类任务配置最大并发数
- [ ] 在application.yml中添加并发控制配置
- [ ] 实现动态配置加载机制

### 3. 信号量控制机制
- [ ] 为每种任务类型创建独立的Semaphore
- [ ] 实现任务执行前获取许可证，执行后释放许可证
- [ ] 处理任务执行异常时的许可证释放

### 4. 任务排队机制
- [ ] 实现FIFO任务队列
- [ ] 支持优先级队列（可选）
- [ ] 当并发数达到上限时，任务进入排队状态

### 5. 线程池动态调整
- [ ] 实现线程池参数的动态调整功能
- [ ] 提供API接口修改线程池配置
- [ ] 监控线程池状态信息

### 6. 任务执行状态跟踪
- [ ] 添加任务状态枚举（WAITING, QUEUED, RUNNING, COMPLETED, FAILED）
- [ ] 实现任务状态查询接口
- [ ] 记录任务执行时间和资源使用情况

## 🧪 测试用例设计

### 单元测试
- [ ] 测试并发控制：多个同类型任务同时提交，检查并发数限制
- [ ] 测试任务排队：超出并发限制的任务是否正确排队
- [ ] 测试任务类型隔离：不同类型任务的并发控制相互独立
- [ ] 测试线程池动态调整：修改配置后线程池参数是否生效
- [ ] 测试异常处理：任务执行失败时许可证是否正确释放

### 集成测试
- [ ] 测试完整的任务调度流程
- [ ] 测试高并发场景下的系统稳定性

## 📦 需要创建/修改的文件

### 新增文件
- [ ] `ConcurrencyConfig.java` - 并发控制配置类
- [ ] `TaskType.java` - 任务类型枚举
- [ ] `TaskStatus.java` - 任务状态枚举
- [ ] `ConcurrencyControlService.java` - 并发控制服务
- [ ] `TaskQueueManager.java` - 任务队列管理器
- [ ] `ConcurrencyControlTest.java` - 并发控制测试类

### 修改文件
- [ ] `TaskRequest.java` - 添加任务类型和优先级字段
- [ ] `TaskService.java` - 集成并发控制机制
- [ ] `TaskController.java` - 添加线程池管理接口
- [ ] `application.yml` - 添加并发控制配置